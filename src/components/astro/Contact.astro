---
const sent = Astro.url.searchParams.get("sent") === "1";
const error = Astro.url.searchParams.get("error") === "1";

const turnstileSiteKey = import.meta.env.PUBLIC_TURNSTILE_SITE_KEY;
---

<section
  id="contact"
  class="flex flex-col gap-item-gap w-[80vw] max-w-[1400px] mx-auto py-item-gap"
>
  <div class="flex flex-col gap-thin-gap">
    <h2>Contact</h2>
    {
      sent && (
        <p class="opacity-50 leading-8">送信しました。ありがとうございます。</p>
      )
    }
    {
      error && (
        <p class="opacity-50 leading-8">
          送信に失敗しました。時間をおいて再度お試しください。
        </p>
      )
    }
  </div>

  <form method="POST" action="/api/contact" class="flex flex-col gap-thin-gap">
    <label class="flex flex-col gap-[calc(var(--thin-gap)/4)]">
      <small class="opacity-50">お名前</small>
      <input
        type="text"
        name="name"
        required
        class="w-full rounded-[1rem] border border-line bg-white px-4 py-3"
      />
    </label>

    <label class="flex flex-col gap-[calc(var(--thin-gap)/4)]">
      <small class="opacity-50">メールアドレス</small>
      <input
        type="email"
        name="email"
        required
        class="w-full rounded-[1rem] border border-line bg-white px-4 py-3"
      />
    </label>

    <label class="flex flex-col gap-[calc(var(--thin-gap)/4)]">
      <small class="opacity-50">メッセージ</small>
      <textarea
        name="message"
        required
        rows={6}
        class="w-full rounded-[1rem] border border-line bg-white px-4 py-3"
      ></textarea>
    </label>

    <!-- Honeypot (bots only) -->
    <input
      type="text"
      name="company"
      tabindex="-1"
      autocomplete="off"
      class="hidden"
    />

    {
      turnstileSiteKey && (
        <>
          <div class="cf-turnstile" data-sitekey={turnstileSiteKey} />
          <script
            src="https://challenges.cloudflare.com/turnstile/v0/api.js"
            async
            defer
          />
        </>
      )
    }

    <div class="flex flex-row items-center gap-[calc(var(--thin-gap)/2)]">
      <button
        type="submit"
        class="text-small font-semibold px-[calc(var(--thin-gap)/1.5)] py-[calc(var(--thin-gap)/2.5)] rounded-[8rem] text-white bg-dark hover:scale-105 transition-all duration-200"
      >
        送信
      </button>
    </div>
  </form>
</section>
